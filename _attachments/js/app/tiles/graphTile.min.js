GraphTile=Class.create(Tile,{initialize:function($super,a,d,b){var c=this;$super(a,b);console.log("maak mijn grafiek");console.log(b);this.oGraph={};this.oOptions=$.extend(true,{timespan:300,smoothScale:1,timespanType:"time",serie:{name:"serie1",data:[],color:"#c05020"},graphOptions:{min:"auto",renderer:"area"}},b);
if(this.oOptions.range&&this.oOptions.range.min&&this.oOptions.range.max&&this.oOptions.timespanType=="time"){this.oOptions.timespan=Math.round((this.oOptions.range.max-this.oOptions.range.min)/1000);
}this.sSelector=a;this.oSeries={};this.oSeries[b.serie.name]=b.serie;this.aSeries=[b.serie];this.zipped=d;this.zipped=this.zipped.map(function(e){return[{serie:b.serie.name,data:e}];
});},vAddSerie:function(c,a,b){this.aSeries.push(a);this.oSeries[a.name]=a;this.zipped=this.zipped.zip(c,function(e,d){e.push({serie:a.name,data:d});return e;
});},vRender:function($super){var a=this;if(!a.disposable){a.disposable=a.zipped.subscribe(function(b){Rx.Observable.fromArray(b).subscribe(function(c){a.vAddData(c.data,a.oSeries[c.serie]);
});});}if(this.aSeries[0].data.length>0){a.oGraph=new Rickshaw.Graph($.extend(true,{element:document.querySelector(a.sSelector),renderer:"area",width:$(a.sSelector).parent().innerWidth(),height:350,min:"auto",padding:{top:0.1,bottom:0.1},stroke:false,series:a.aSeries},a.oOptions.graphOptions));
a.hoverDetail=new Rickshaw.Graph.HoverDetail({graph:a.oGraph,xFormatter:function(b){return new Date(b*1000).toString();},});a.smoother=new Rickshaw.Graph.Smoother({graph:a.oGraph});
a.smoother.setScale(a.oOptions.smoothScale);a.xAxis=new Rickshaw.Graph.Axis.Time({graph:a.oGraph,timeFixture:new Rickshaw.Fixtures.Time.Local()});a.yAxis=new Rickshaw.Graph.Axis.Y({graph:a.oGraph});
a.xAxis.render();a.oGraph.render();a.bRendered=true;}},vAddData:function(d,c){var e=this;var b=c.data;b.push(d);if(e.oOptions.timespanType==="data"){b.shift();
}if(e.oOptions.timespanType==="time"){iLatestTime=d.x-e.oOptions.timespan;var a=false;while(!a){if(b[0].x<iLatestTime){b.shift();}else{a=true;}}}e.vUpdate();
},vUpdate:function($super,b,a){var c=this;if(c.oUpdateTimeout){clearInterval(c.oUpdateTimeout);}if(typeof b==="undefined"||!b){c.oUpdateTimeout=setTimeout(function(){c.vUpdate(true);
},100);}else{if(this.bRendered){this.oGraph.render();}else{this.vRender();}$super();}},vResize:function(){if(typeof this.oGraph!=="undefined"&&this.oGraph!==null){this.oGraph.configure({width:$(this.sSelector).parent().innerWidth()});
this.vUpdate();}},vSetSmooth:function(a){this.oOptions.smoothScale=a;},vSetTimespan:function(b,a){if(b>a){this.vSetTimespanSeconds(Math.round(b-a));}else{this.vSetTimespanSeconds(Math.round(a-b));
}},vSetTimespanSeconds:function(a){this.iTimespan=a;}});